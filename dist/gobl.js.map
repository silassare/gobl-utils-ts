{"version":3,"file":"gobl.js","sourceRoot":"","sources":["../src/gobl.ts"],"names":[],"mappings":"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","sourcesContent":["import GoblEntity, { tGoblEntityData } from './GoblEntity';\n\nconst win: any = window;\nexport const gobl: any = (win.gobl = win.gobl || {}),\n\tgoblMarker = '__gobl__',\n\tgoblCache: {\n\t\t[entity: string]: { [key: string]: GoblEntity };\n\t} = (gobl.goblCache = gobl.goblCache || {}),\n\tgoblClassMagicMap: {\n\t\t[key: string]: string;\n\t} = (gobl.goblClassMagicMap = gobl.goblClassMagicMap || {}),\n\t/**\n\t * Try to identify and instantiate the entity class that best matches the given data.\n\t *\n\t * @param data\n\t * @param cache\n\t */\n\ttoInstance = function (\n\t\tdata: tGoblEntityData,\n\t\tcache = false,\n\t): GoblEntity | undefined {\n\t\tif (Object.prototype.toString.call(data) === '[object Object]') {\n\t\t\tlet entityName = data[goblMarker],\n\t\t\t\tentity,\n\t\t\t\tmagic,\n\t\t\t\told: GoblEntity,\n\t\t\t\te: GoblEntity,\n\t\t\t\tcacheKey;\n\n\t\t\tif (entityName) {\n\t\t\t\tentity = gobl[entityName];\n\t\t\t\t// maybe the entity name change\n\t\t\t\t// this is to have a clean object\n\t\t\t\tdelete data[goblMarker];\n\t\t\t}\n\n\t\t\tif (!entity) {\n\t\t\t\tmagic = Object.keys(data).sort().join('');\n\t\t\t\tentityName = goblClassMagicMap[magic];\n\n\t\t\t\tif (entityName) {\n\t\t\t\t\tentity = gobl[entityName];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (entity) {\n\t\t\t\te = new entity(data);\n\t\t\t\t// tslint:disable-next-line: no-conditional-assignment\n\t\t\t\tif (true === cache && (cacheKey = e.cacheKey())) {\n\t\t\t\t\told = goblCache[entityName][cacheKey];\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\te = old.doHydrate(data);\n\t\t\t\t\t}\n\n\t\t\t\t\tgoblCache[entityName][cacheKey] = e;\n\t\t\t\t}\n\n\t\t\t\treturn e;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t};\n\nexport const register = function (name: string, entity: typeof GoblEntity) {\n\tgobl[name] = entity;\n\tgoblCache[name] = {};\n\tgoblClassMagicMap[(entity as any).COLUMNS.sort().join('')] = name;\n};\n\nexport const getEntityCache = (entityName: string) => goblCache[entityName];\n\nexport const _bool = (v: any): boolean => {\n\t// @ts-ignore\n\treturn v === null || v === undefined ? v : Boolean(v === '0' ? 0 : v);\n};\n\nexport const _int = (v: any): number => {\n\t// @ts-ignore\n\treturn v === null || v === undefined ? v : parseInt(v);\n};\n\nexport const _string = (v: any): string => {\n\t// @ts-ignore\n\treturn v === null || v === undefined ? '' : String(v);\n};\n"]}