const win = window, gobl = (win.gobl = win.gobl || {}), _hasOwn = Object.hasOwnProperty, _isPlainObject = (a) => Object.prototype.toString.call(a) === '[object Object]', gobl_marker = '__gobl__', gobl_cache = {}, gobl_class_magic_map = {}, realJSONParse = JSON.parse, goblJSONParse = function (text, reviver) {
    return realJSONParse(text, function (key, value) {
        if (typeof reviver === 'function') {
            value = reviver(key, value);
        }
        if (_isPlainObject(value)) {
            let i = GoblEntity.toInstance(value, true);
            if (i) {
                return i;
            }
        }
        return value;
    });
}, ACTION_UNKNOWN = 0, ACTION_SAVING = 1, ACTION_DELETING = 2, ACTION_UPDATING = 3;
/**
 * GoblEntity class.
 */
export class GoblEntity {
    constructor(_initial_data = {}, _name, _prefix, _columns) {
        this._name = _name;
        this._prefix = _prefix;
        this._columns = _columns;
        this._data = {};
        this._cache = {};
        this._action = ACTION_UNKNOWN;
        let ctx = this, 
        // we use null not undefined since JSON.stringify will ignore properties with undefined value
        _def = null;
        _columns.forEach(function (col) {
            ctx._data[col] = ctx._cache[col] =
                col in _initial_data ? _initial_data[col] : _def;
        });
    }
    /**
     * Magic setter.
     *
     * @param column
     * @param value
     */
    _set(column, value) {
        if (_hasOwn.call(this._data, column)) {
            this._data[column] = value;
        }
        return this;
    }
    /**
     * Checks is the entity is clean.
     */
    isClean() {
        return Object.keys(this.toObject(true)).length === 0;
    }
    /**
     * Checks if the entity is saved.
     *
     * @param set When true the entity will be considered as saved.
     */
    isSaved(set) {
        if (set) {
            this._cache = this.toObject();
            return true;
        }
        return this.isClean();
    }
    /**
     * Checks if the entity is being saved.
     *
     * @param set When true the state will be set to saving.
     */
    isSaving(set) {
        if (arguments.length) {
            this._action = set ? ACTION_SAVING : ACTION_UNKNOWN;
        }
        return this._action === ACTION_SAVING;
    }
    /**
     * Checks if the entity is being deleted.
     *
     * @param set When true the state will be set to deleting.
     */
    isDeleting(set) {
        if (arguments.length) {
            this._action = set ? ACTION_DELETING : ACTION_UNKNOWN;
        }
        return this._action === ACTION_DELETING;
    }
    /**
     * Checks if the entity is being updated.
     *
     * @param set When true the state will be set to updating.
     */
    isUpdating(set) {
        if (arguments.length) {
            this._action = set ? ACTION_UPDATING : ACTION_UNKNOWN;
        }
        return this._action === ACTION_UPDATING;
    }
    /**
     * Hydrate the entity and set as saved when `save` is true
     */
    doHydrate(data, save = false) {
        let ctx = this, source_of_truth = this._data;
        Object.keys(data).forEach(function (k) {
            if (_hasOwn.call(source_of_truth, k)) {
                ctx[k.slice(ctx._prefix.length + 1)] = data[k];
            }
        });
        if (save) {
            this.isSaved(true);
        }
        return this;
    }
    /**
     * Returns current data in a clean new object
     *
     * if `diff` is true, returns modified columns only
     */
    toObject(diff = false) {
        let o = {};
        if (diff) {
            for (let k in this._cache) {
                if (_hasOwn.call(this._cache, k)) {
                    if (this._cache[k] !== this._data[k]) {
                        o[k] = this._data[k];
                    }
                }
            }
            return o;
        }
        for (let k in this._data) {
            if (_hasOwn.call(this._data, k)) {
                o[k] = this._data[k];
            }
        }
        return o;
    }
    /**
     * Returns some column values
     */
    toObjectSome(columns) {
        let o = {}, len = columns.length;
        for (let i = 0; i < len; i++) {
            let col = columns[i];
            if (_hasOwn.call(this._data, col)) {
                o[col] = this._data[col];
            }
            else {
                throw new Error(`Column "${col}" is not defined in "${this._name}".`);
            }
        }
        return o;
    }
    /**
     * JSON helper
     */
    toJSON() {
        let data = this.toObject();
        data[gobl_marker] = this._name;
        return data;
    }
    /**
     * Try to identify and instantiate the entity class that best matches the given data.
     *
     * @param data
     * @param cache
     */
    static toInstance(data, cache = false) {
        if (_isPlainObject(data)) {
            let entity_name = data[gobl_marker], entity, magic, old, e, cache_key;
            if (entity_name) {
                entity = gobl[entity_name];
                // maybe the entity name change
                // this is to have a clean object
                delete data[gobl_marker];
            }
            if (!entity) {
                magic = Object.keys(data)
                    .sort()
                    .join('');
                entity_name = gobl_class_magic_map[magic];
                if (entity_name) {
                    entity = gobl[entity_name];
                }
            }
            if (entity) {
                e = new entity(data);
                if (true === cache && (cache_key = e.cacheKey())) {
                    old = gobl_cache[entity_name][cache_key];
                    if (old) {
                        e = old.doHydrate(data);
                    }
                    gobl_cache[entity_name][cache_key] = e;
                }
                return e;
            }
        }
        return undefined;
    }
    /**
     * Returns a given entity cache.
     *
     * @param entity
     */
    static subCache(entity) {
        return gobl_cache[entity];
    }
    /**
     * Returns the entity cache key.
     *
     * `null` is returned when we can't have a valid cache key.
     */
    cacheKey() {
        let columns = this.identifierColumns().sort(), len = columns.length, value = '', i = 0;
        if (len === 1) {
            value = this._data[columns[0]];
        }
        else {
            for (; i < len; i++) {
                let v = this._data[columns[i]];
                if (v != null) {
                    value += v;
                }
            }
        }
        return value || null;
    }
}
export class GoblSinglePKEntity extends GoblEntity {
}
export const register = function (name, entity) {
    gobl[name] = entity;
    gobl_cache[name] = {};
    gobl_class_magic_map[entity['COLUMNS'].sort().join('')] = name;
};
export const getEntityCache = (entity_name) => gobl_cache[entity_name];
export const c_bool = (v) => {
    // @ts-ignore
    return v === null || v === undefined ? v : Boolean(v === '0' ? 0 : v);
};
export const c_int = (v) => {
    // @ts-ignore
    return v === null || v === undefined ? v : parseInt(v);
};
export const c_string = (v) => {
    // @ts-ignore
    return v === null || v === undefined ? '' : String(v);
};
JSON.parse = goblJSONParse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29ibC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9nb2JsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE1BQU0sR0FBRyxHQUFRLE1BQU0sRUFDdEIsSUFBSSxHQUFRLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUN2QyxPQUFPLEdBQUcsTUFBTSxDQUFDLGNBQWMsRUFDL0IsY0FBYyxHQUFHLENBQUMsQ0FBTSxFQUFXLEVBQUUsQ0FDcEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLGlCQUFpQixFQUN4RCxXQUFXLEdBQUcsVUFBVSxFQUN4QixVQUFVLEdBRU4sRUFBRSxFQUNOLG9CQUFvQixHQUE4QixFQUFFLEVBQ3BELGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUMxQixhQUFhLEdBQUcsVUFDZixJQUFTLEVBQ1QsT0FBdUM7SUFFdkMsT0FBTyxhQUFhLENBQUMsSUFBSSxFQUFFLFVBQVMsR0FBRyxFQUFFLEtBQUs7UUFDN0MsSUFBSSxPQUFPLE9BQU8sS0FBSyxVQUFVLEVBQUU7WUFDbEMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDNUI7UUFFRCxJQUFJLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQixJQUFJLENBQUMsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsRUFBRTtnQkFDTixPQUFPLENBQUMsQ0FBQzthQUNUO1NBQ0Q7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxFQUNELGNBQWMsR0FBRyxDQUFDLEVBQ2xCLGFBQWEsR0FBRyxDQUFDLEVBQ2pCLGVBQWUsR0FBRyxDQUFDLEVBQ25CLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFF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QUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZFLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQU0sRUFBVSxFQUFFO0lBQ3ZDLGFBQWE7SUFDYixPQUFPLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBTSxFQUFVLEVBQUU7SUFDMUMsYUFBYTtJQUNiLE9BQU8sQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2RCxDQUFDLENBQUM7QUFFRixJQUFJLENBQUMsS0FBSyxHQUFHLGFBQWEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIHRHb2JsRW50aXR5RGF0YSA9IHtcblx0W2tleTogc3RyaW5nXTogYW55O1xufTtcbmV4cG9ydCB0eXBlIHRHb2JsQ2FjaGU8VD4gPSB7IFtrZXk6IHN0cmluZ106IFQgfTtcblxuY29uc3Qgd2luOiBhbnkgPSB3aW5kb3csXG5cdGdvYmw6IGFueSA9ICh3aW4uZ29ibCA9IHdpbi5nb2JsIHx8IHt9KSxcblx0X2hhc093biA9IE9iamVjdC5oYXNPd25Qcm9wZXJ0eSxcblx0X2lzUGxhaW5PYmplY3QgPSAoYTogYW55KTogYm9vbGVhbiA9PlxuXHRcdE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScsXG5cdGdvYmxfbWFya2VyID0gJ19fZ29ibF9fJyxcblx0Z29ibF9jYWNoZToge1xuXHRcdFtlbnRpdHk6IHN0cmluZ106IHRHb2JsQ2FjaGU8R29ibEVudGl0eT47XG5cdH0gPSB7fSxcblx0Z29ibF9jbGFzc19tYWdpY19tYXA6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fSxcblx0cmVhbEpTT05QYXJzZSA9IEpTT04ucGFyc2UsXG5cdGdvYmxKU09OUGFyc2UgPSBmdW5jdGlvbihcblx0XHR0ZXh0OiBhbnksXG5cdFx0cmV2aXZlcj86IChrZXk6IGFueSwgdmFsdWU6IGFueSkgPT4gYW55XG5cdCkge1xuXHRcdHJldHVybiByZWFsSlNPTlBhcnNlKHRleHQsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcblx0XHRcdGlmICh0eXBlb2YgcmV2aXZlciA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHR2YWx1ZSA9IHJldml2ZXIoa2V5LCB2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcblx0XHRcdFx0bGV0IGkgPSBHb2JsRW50aXR5LnRvSW5zdGFuY2UodmFsdWUsIHRydWUpO1xuXHRcdFx0XHRpZiAoaSkge1xuXHRcdFx0XHRcdHJldHVybiBpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9KTtcblx0fSxcblx0QUNUSU9OX1VOS05PV04gPSAwLFxuXHRBQ1RJT05fU0FWSU5HID0gMSxcblx0QUNUSU9OX0RFTEVUSU5HID0gMixcblx0QUNUSU9OX1VQREFUSU5HID0gMztcblxuLyoqXG4gKiBHb2JsRW50aXR5IGNsYXNzLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgR29ibEVudGl0eSB7XG5cdHByb3RlY3RlZCByZWFkb25seSBfZGF0YTogYW55ID0ge307XG5cdHByb3RlY3RlZCBfY2FjaGU6IGFueSA9IHt9O1xuXHRwcm90ZWN0ZWQgX2FjdGlvbjogbnVtYmVyID0gQUNUSU9OX1VOS05PV047XG5cblx0cHJvdGVjdGVkIGNvbnN0cnVjdG9yKFxuXHRcdF9pbml0aWFsX2RhdGE6IHRHb2JsRW50aXR5RGF0YSA9IHt9LFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgX25hbWU6IHN0cmluZyxcblx0XHRwcml2YXRlIHJlYWRvbmx5IF9wcmVmaXg6IHN0cmluZyxcblx0XHRwcml2YXRlIHJlYWRvbmx5IF9jb2x1bW5zOiBzdHJpbmdbXVxuXHQpIHtcblx0XHRsZXQgY3R4ID0gdGhpcyxcblx0XHRcdC8vIHdlIHVzZSBudWxsIG5vdCB1bmRlZmluZWQgc2luY2UgSlNPTi5zdHJpbmdpZnkgd2lsbCBpZ25vcmUgcHJvcGVydGllcyB3aXRoIHVuZGVmaW5lZCB2YWx1ZVxuXHRcdFx0X2RlZjogbnVsbCA9IG51bGw7XG5cblx0XHRfY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCkge1xuXHRcdFx0Y3R4Ll9kYXRhW2NvbF0gPSBjdHguX2NhY2hlW2NvbF0gPVxuXHRcdFx0XHRjb2wgaW4gX2luaXRpYWxfZGF0YSA/IF9pbml0aWFsX2RhdGFbY29sXSA6IF9kZWY7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogTWFnaWMgc2V0dGVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29sdW1uXG5cdCAqIEBwYXJhbSB2YWx1ZVxuXHQgKi9cblx0cHJvdGVjdGVkIF9zZXQoY29sdW1uOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB0aGlzIHtcblx0XHRpZiAoX2hhc093bi5jYWxsKHRoaXMuX2RhdGEsIGNvbHVtbikpIHtcblx0XHRcdHRoaXMuX2RhdGFbY29sdW1uXSA9IHZhbHVlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpcyB0aGUgZW50aXR5IGlzIGNsZWFuLlxuXHQgKi9cblx0aXNDbGVhbigpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXModGhpcy50b09iamVjdCh0cnVlKSkubGVuZ3RoID09PSAwO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgZW50aXR5IGlzIHNhdmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gc2V0IFdoZW4gdHJ1ZSB0aGUgZW50aXR5IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBzYXZlZC5cblx0ICovXG5cdGlzU2F2ZWQoc2V0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuXHRcdGlmIChzZXQpIHtcblx0XHRcdHRoaXMuX2NhY2hlID0gdGhpcy50b09iamVjdCgpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuaXNDbGVhbigpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgZW50aXR5IGlzIGJlaW5nIHNhdmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gc2V0IFdoZW4gdHJ1ZSB0aGUgc3RhdGUgd2lsbCBiZSBzZXQgdG8gc2F2aW5nLlxuXHQgKi9cblx0aXNTYXZpbmcoc2V0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb24gPSBzZXQgPyBBQ1RJT05fU0FWSU5HIDogQUNUSU9OX1VOS05PV047XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX2FjdGlvbiA9PT0gQUNUSU9OX1NBVklORztcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGVudGl0eSBpcyBiZWluZyBkZWxldGVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gc2V0IFdoZW4gdHJ1ZSB0aGUgc3RhdGUgd2lsbCBiZSBzZXQgdG8gZGVsZXRpbmcuXG5cdCAqL1xuXHRpc0RlbGV0aW5nKHNldD86IGJvb2xlYW4pOiBib29sZWFuIHtcblx0XHRpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuXHRcdFx0dGhpcy5fYWN0aW9uID0gc2V0ID8gQUNUSU9OX0RFTEVUSU5HIDogQUNUSU9OX1VOS05PV047XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX2FjdGlvbiA9PT0gQUNUSU9OX0RFTEVUSU5HO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgZW50aXR5IGlzIGJlaW5nIHVwZGF0ZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBzZXQgV2hlbiB0cnVlIHRoZSBzdGF0ZSB3aWxsIGJlIHNldCB0byB1cGRhdGluZy5cblx0ICovXG5cdGlzVXBkYXRpbmcoc2V0PzogYm9vbGVhbik6IGJvb2xlYW4ge1xuXHRcdGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLl9hY3Rpb24gPSBzZXQgPyBBQ1RJT05fVVBEQVRJTkcgOiBBQ1RJT05fVU5LTk9XTjtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uID09PSBBQ1RJT05fVVBEQVRJTkc7XG5cdH1cblxuXHQvKipcblx0ICogSHlkcmF0ZSB0aGUgZW50aXR5IGFuZCBzZXQgYXMgc2F2ZWQgd2hlbiBgc2F2ZWAgaXMgdHJ1ZVxuXHQgKi9cblx0ZG9IeWRyYXRlKGRhdGE6IHRHb2JsRW50aXR5RGF0YSwgc2F2ZTogYm9vbGVhbiA9IGZhbHNlKTogdGhpcyB7XG5cdFx0bGV0IGN0eCA9IHRoaXMsXG5cdFx0XHRzb3VyY2Vfb2ZfdHJ1dGggPSB0aGlzLl9kYXRhO1xuXG5cdFx0T2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XG5cdFx0XHRpZiAoX2hhc093bi5jYWxsKHNvdXJjZV9vZl90cnV0aCwgaykpIHtcblx0XHRcdFx0KGN0eCBhcyBhbnkpW2suc2xpY2UoY3R4Ll9wcmVmaXgubGVuZ3RoICsgMSldID0gZGF0YVtrXTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmIChzYXZlKSB7XG5cdFx0XHR0aGlzLmlzU2F2ZWQodHJ1ZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBjdXJyZW50IGRhdGEgaW4gYSBjbGVhbiBuZXcgb2JqZWN0XG5cdCAqXG5cdCAqIGlmIGBkaWZmYCBpcyB0cnVlLCByZXR1cm5zIG1vZGlmaWVkIGNvbHVtbnMgb25seVxuXHQgKi9cblx0dG9PYmplY3QoZGlmZjogYm9vbGVhbiA9IGZhbHNlKTogdEdvYmxFbnRpdHlEYXRhIHtcblx0XHRsZXQgbzogYW55ID0ge307XG5cblx0XHRpZiAoZGlmZikge1xuXHRcdFx0Zm9yIChsZXQgayBpbiB0aGlzLl9jYWNoZSkge1xuXHRcdFx0XHRpZiAoX2hhc093bi5jYWxsKHRoaXMuX2NhY2hlLCBrKSkge1xuXHRcdFx0XHRcdGlmICh0aGlzLl9jYWNoZVtrXSAhPT0gdGhpcy5fZGF0YVtrXSkge1xuXHRcdFx0XHRcdFx0b1trXSA9IHRoaXMuX2RhdGFba107XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbztcblx0XHR9XG5cblx0XHRmb3IgKGxldCBrIGluIHRoaXMuX2RhdGEpIHtcblx0XHRcdGlmIChfaGFzT3duLmNhbGwodGhpcy5fZGF0YSwgaykpIHtcblx0XHRcdFx0b1trXSA9IHRoaXMuX2RhdGFba107XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBzb21lIGNvbHVtbiB2YWx1ZXNcblx0ICovXG5cdHRvT2JqZWN0U29tZShjb2x1bW5zOiBzdHJpbmdbXSk6IHRHb2JsRW50aXR5RGF0YSB7XG5cdFx0bGV0IG86IGFueSA9IHt9LFxuXHRcdFx0bGVuID0gY29sdW1ucy5sZW5ndGg7XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRsZXQgY29sID0gY29sdW1uc1tpXTtcblx0XHRcdGlmIChfaGFzT3duLmNhbGwodGhpcy5fZGF0YSwgY29sKSkge1xuXHRcdFx0XHRvW2NvbF0gPSB0aGlzLl9kYXRhW2NvbF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0YENvbHVtbiBcIiR7Y29sfVwiIGlzIG5vdCBkZWZpbmVkIGluIFwiJHt0aGlzLl9uYW1lfVwiLmBcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbztcblx0fVxuXG5cdC8qKlxuXHQgKiBKU09OIGhlbHBlclxuXHQgKi9cblx0dG9KU09OKCk6IGFueSB7XG5cdFx0bGV0IGRhdGEgPSB0aGlzLnRvT2JqZWN0KCk7XG5cdFx0ZGF0YVtnb2JsX21hcmtlcl0gPSB0aGlzLl9uYW1lO1xuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblxuXHQvKipcblx0ICogVHJ5IHRvIGlkZW50aWZ5IGFuZCBpbnN0YW50aWF0ZSB0aGUgZW50aXR5IGNsYXNzIHRoYXQgYmVzdCBtYXRjaGVzIHRoZSBnaXZlbiBkYXRhLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YVxuXHQgKiBAcGFyYW0gY2FjaGVcblx0ICovXG5cdHN0YXRpYyB0b0luc3RhbmNlKFxuXHRcdGRhdGE6IHRHb2JsRW50aXR5RGF0YSxcblx0XHRjYWNoZSA9IGZhbHNlXG5cdCk6IEdvYmxFbnRpdHkgfCB1bmRlZmluZWQge1xuXHRcdGlmIChfaXNQbGFpbk9iamVjdChkYXRhKSkge1xuXHRcdFx0bGV0IGVudGl0eV9uYW1lID0gZGF0YVtnb2JsX21hcmtlcl0sXG5cdFx0XHRcdGVudGl0eSxcblx0XHRcdFx0bWFnaWMsXG5cdFx0XHRcdG9sZDogR29ibEVudGl0eSxcblx0XHRcdFx0ZTogR29ibEVudGl0eSxcblx0XHRcdFx0Y2FjaGVfa2V5O1xuXG5cdFx0XHRpZiAoZW50aXR5X25hbWUpIHtcblx0XHRcdFx0ZW50aXR5ID0gZ29ibFtlbnRpdHlfbmFtZV07XG5cdFx0XHRcdC8vIG1heWJlIHRoZSBlbnRpdHkgbmFtZSBjaGFuZ2Vcblx0XHRcdFx0Ly8gdGhpcyBpcyB0byBoYXZlIGEgY2xlYW4gb2JqZWN0XG5cdFx0XHRcdGRlbGV0ZSBkYXRhW2dvYmxfbWFya2VyXTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFlbnRpdHkpIHtcblx0XHRcdFx0bWFnaWMgPSBPYmplY3Qua2V5cyhkYXRhKVxuXHRcdFx0XHRcdC5zb3J0KClcblx0XHRcdFx0XHQuam9pbignJyk7XG5cdFx0XHRcdGVudGl0eV9uYW1lID0gZ29ibF9jbGFzc19tYWdpY19tYXBbbWFnaWNdO1xuXG5cdFx0XHRcdGlmIChlbnRpdHlfbmFtZSkge1xuXHRcdFx0XHRcdGVudGl0eSA9IGdvYmxbZW50aXR5X25hbWVdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbnRpdHkpIHtcblx0XHRcdFx0ZSA9IG5ldyBlbnRpdHkoZGF0YSk7XG5cdFx0XHRcdGlmICh0cnVlID09PSBjYWNoZSAmJiAoY2FjaGVfa2V5ID0gZS5jYWNoZUtleSgpKSkge1xuXHRcdFx0XHRcdG9sZCA9IGdvYmxfY2FjaGVbZW50aXR5X25hbWVdW2NhY2hlX2tleV07XG5cdFx0XHRcdFx0aWYgKG9sZCkge1xuXHRcdFx0XHRcdFx0ZSA9IG9sZC5kb0h5ZHJhdGUoZGF0YSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Z29ibF9jYWNoZVtlbnRpdHlfbmFtZV1bY2FjaGVfa2V5XSA9IGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdW5kZWZpbmVkO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgYSBnaXZlbiBlbnRpdHkgY2FjaGUuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbnRpdHlcblx0ICovXG5cdHN0YXRpYyBzdWJDYWNoZShlbnRpdHk6IHN0cmluZyk6IHRHb2JsQ2FjaGU8R29ibEVudGl0eT4gfCB1bmRlZmluZWQge1xuXHRcdHJldHVybiBnb2JsX2NhY2hlW2VudGl0eV07XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgZW50aXR5IGNhY2hlIGtleS5cblx0ICpcblx0ICogYG51bGxgIGlzIHJldHVybmVkIHdoZW4gd2UgY2FuJ3QgaGF2ZSBhIHZhbGlkIGNhY2hlIGtleS5cblx0ICovXG5cdGNhY2hlS2V5KCk6IHN0cmluZyB8IG51bGwge1xuXHRcdGxldCBjb2x1bW5zID0gdGhpcy5pZGVudGlmaWVyQ29sdW1ucygpLnNvcnQoKSxcblx0XHRcdGxlbiA9IGNvbHVtbnMubGVuZ3RoLFxuXHRcdFx0dmFsdWUgPSAnJyxcblx0XHRcdGkgPSAwO1xuXG5cdFx0aWYgKGxlbiA9PT0gMSkge1xuXHRcdFx0dmFsdWUgPSB0aGlzLl9kYXRhW2NvbHVtbnNbMF1dO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRcdGxldCB2ID0gdGhpcy5fZGF0YVtjb2x1bW5zW2ldXTtcblx0XHRcdFx0aWYgKHYgIT0gbnVsbCkge1xuXHRcdFx0XHRcdHZhbHVlICs9IHY7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWUgfHwgbnVsbDtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBwcmltYXJ5IGtleXMgb2YgdGhlIGVudGl0eS5cblx0ICovXG5cdGFic3RyYWN0IGlkZW50aWZpZXJDb2x1bW5zKCk6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgR29ibFNpbmdsZVBLRW50aXR5IGV4dGVuZHMgR29ibEVudGl0eSB7XG5cdGFic3RyYWN0IHNpbmdsZVBLVmFsdWUoKTogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgcmVnaXN0ZXIgPSBmdW5jdGlvbihuYW1lOiBzdHJpbmcsIGVudGl0eTogR29ibEVudGl0eSkge1xuXHRnb2JsW25hbWVdID0gZW50aXR5O1xuXHRnb2JsX2NhY2hlW25hbWVdID0ge307XG5cdGdvYmxfY2xhc3NfbWFnaWNfbWFwWyhlbnRpdHkgYXMgYW55KVsnQ09MVU1OUyddLnNvcnQoKS5qb2luKCcnKV0gPSBuYW1lO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEVudGl0eUNhY2hlID0gKGVudGl0eV9uYW1lOiBzdHJpbmcpID0+IGdvYmxfY2FjaGVbZW50aXR5X25hbWVdO1xuXG5leHBvcnQgY29uc3QgY19ib29sID0gKHY6IGFueSk6IGJvb2xlYW4gPT4ge1xuXHQvLyBAdHMtaWdub3JlXG5cdHJldHVybiB2ID09PSBudWxsIHx8IHYgPT09IHVuZGVmaW5lZCA/IHYgOiBCb29sZWFuKHYgPT09ICcwJyA/IDAgOiB2KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjX2ludCA9ICh2OiBhbnkpOiBudW1iZXIgPT4ge1xuXHQvLyBAdHMtaWdub3JlXG5cdHJldHVybiB2ID09PSBudWxsIHx8IHYgPT09IHVuZGVmaW5lZCA/IHYgOiBwYXJzZUludCh2KTtcbn07XG5cbmV4cG9ydCBjb25zdCBjX3N0cmluZyA9ICh2OiBhbnkpOiBzdHJpbmcgPT4ge1xuXHQvLyBAdHMtaWdub3JlXG5cdHJldHVybiB2ID09PSBudWxsIHx8IHYgPT09IHVuZGVmaW5lZCA/ICcnIDogU3RyaW5nKHYpO1xufTtcblxuSlNPTi5wYXJzZSA9IGdvYmxKU09OUGFyc2U7XG4iXX0=